<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNE 修復驗證</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f6f1eb;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        img {
            max-width: 100px;
            height: auto;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>PNE 應用程式修復驗證</h1>
    
    <div class="info">
        <h3>修復項目檢查</h3>
        <p>此頁面用於驗證所有修復是否正確完成</p>
    </div>
    
    <div id="status-container">
        <h3>檢查結果：</h3>
        <div id="results"></div>
    </div>
    
    <h3>圖標測試：</h3>
    <div id="icon-test">
        <p>測試不同尺寸的圖標載入：</p>
        <img src="./assets/images/icon-72x72.png" alt="72x72 圖標" onerror="showError(this)">
        <img src="./assets/images/icon-144x144.png" alt="144x144 圖標" onerror="showError(this)">
        <img src="./assets/images/icon-192x192.png" alt="192x192 圖標" onerror="showError(this)">
        <img src="./assets/images/icon-512x512.png" alt="512x512 圖標" onerror="showError(this)">
    </div>
    
    <h3>Favicon 測試：</h3>
    <div id="favicon-test">
        <p>測試 favicon 載入：</p>
        <img src="./favicon.svg" alt="SVG Favicon" onerror="showError(this)">
        <img src="./favicon.ico" alt="ICO Favicon" onerror="showError(this)">
    </div>
    
    <script>
        function showError(img) {
            img.style.border = '2px solid red';
            img.alt = '載入失敗: ' + img.src;
        }
        
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            resultsDiv.appendChild(div);
        }
        
        // 檢查 Service Worker 支援
        if ('serviceWorker' in navigator) {
            addResult('✅ Service Worker 支援正常', 'success');
        } else {
            addResult('❌ Service Worker 不支援', 'error');
        }
        
        // 檢查 IndexedDB 支援
        if ('indexedDB' in window) {
            addResult('✅ IndexedDB 支援正常', 'success');
        } else {
            addResult('❌ IndexedDB 不支援', 'error');
        }
        
        // 檢查 HTTPS
        if (location.protocol === 'https:') {
            addResult('✅ HTTPS 環境正常', 'success');
        } else if (location.hostname === 'localhost') {
            addResult('✅ Localhost 環境正常', 'success');
        } else {
            addResult('⚠️ 非 HTTPS 環境，某些功能可能受限', 'error');
        }
        
        // 檢查 manifest.json
        fetch('./manifest.json')
            .then(response => {
                if (response.ok) {
                    addResult('✅ manifest.json 載入正常', 'success');
                    return response.json();
                } else {
                    addResult('❌ manifest.json 載入失敗', 'error');
                    throw new Error('Manifest load failed');
                }
            })
            .then(manifest => {
                if (manifest.icons && manifest.icons.length > 0) {
                    addResult(`✅ manifest.json 包含 ${manifest.icons.length} 個圖標`, 'success');
                } else {
                    addResult('❌ manifest.json 缺少圖標定義', 'error');
                }
            })
            .catch(error => {
                addResult('❌ manifest.json 檢查失敗: ' + error.message, 'error');
            });
        
        // 檢查 Service Worker 註冊
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(registration => {
                    addResult('✅ Service Worker 註冊成功', 'success');
                })
                .catch(error => {
                    addResult('❌ Service Worker 註冊失敗: ' + error.message, 'error');
                });
        }
        
        // 檢查圖標載入
        const iconSizes = ['72x72', '96x96', '128x128', '144x144', '152x152', '192x192', '384x384', '512x512'];
        let loadedIcons = 0;
        
        iconSizes.forEach(size => {
            const img = new Image();
            img.onload = () => {
                loadedIcons++;
                if (loadedIcons === iconSizes.length) {
                    addResult(`✅ 所有 ${iconSizes.length} 個圖標載入成功`, 'success');
                }
            };
            img.onerror = () => {
                addResult(`❌ 圖標 ${size} 載入失敗`, 'error');
            };
            img.src = `./assets/images/icon-${size}.png`;
        });
    </script>
</body>
</html>
