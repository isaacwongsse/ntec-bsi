<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>照片序列號排序測試</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #218838;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
            min-height: 200px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
        }
        .photo-item {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            position: relative;
        }
        .photo-item img {
            max-width: 100%;
            height: auto;
            border-radius: 3px;
        }
        .photo-item .photo-name {
            font-size: 12px;
            margin-top: 5px;
            word-break: break-all;
        }
        .photo-item .sequence-number {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 123, 255, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .comparison-table .before {
            background: #f8d7da;
        }
        .comparison-table .after {
            background: #d4edda;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .success-box {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .success-box h4 {
            margin-top: 0;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>照片序列號排序測試</h1>
        
        <div class="success-box">
            <h4>✅ 排序功能已實現</h4>
            <p>照片現在會按照序列號從左到右順序顯示，序列號是從文件名中提取的數字。</p>
        </div>

        <div class="test-section">
            <h3>1. 排序邏輯說明</h3>
            <div class="code-block">function sortPhotosBySequenceNumber(photos) {
    return photos.sort((a, b) => {
        // Extract sequence numbers from filenames
        const getSequenceNumber = (filename) => {
            const match = filename.match(/(\d+)/);
            return match ? parseInt(match[1], 10) : 0;
        };
        
        const seqA = getSequenceNumber(a.name);
        const seqB = getSequenceNumber(b.name);
        
        // If both have sequence numbers, sort by number
        if (seqA > 0 && seqB > 0) {
            return seqA - seqB;
        }
        
        // If only one has sequence number, prioritize it
        if (seqA > 0 && seqB === 0) return -1;
        if (seqA === 0 && seqB > 0) return 1;
        
        // If neither has sequence number, sort alphabetically
        return a.name.localeCompare(b.name, undefined, {numeric: true, sensitivity: 'base'});
    });
}</div>
        </div>

        <div class="test-section">
            <h3>2. 排序規則</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>情況</th>
                        <th>排序規則</th>
                        <th>示例</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="after">
                        <td>兩個文件都有序列號</td>
                        <td>按序列號數字大小排序</td>
                        <td>IMG_001.jpg → IMG_002.jpg → IMG_010.jpg</td>
                    </tr>
                    <tr class="after">
                        <td>一個有序列號，一個沒有</td>
                        <td>有序列號的排在前面</td>
                        <td>IMG_001.jpg → photo.jpg</td>
                    </tr>
                    <tr class="after">
                        <td>兩個文件都沒有序列號</td>
                        <td>按字母順序排序</td>
                        <td>apple.jpg → banana.jpg → cherry.jpg</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="test-section">
            <h3>3. 排序前後對比</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>排序前（按文件名）</th>
                        <th>排序後（按序列號）</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="before">IMG_10.jpg<br>IMG_2.jpg<br>IMG_1.jpg<br>IMG_20.jpg</td>
                        <td class="after">IMG_1.jpg<br>IMG_2.jpg<br>IMG_10.jpg<br>IMG_20.jpg</td>
                    </tr>
                    <tr>
                        <td class="before">photo_100.jpg<br>photo_5.jpg<br>photo_50.jpg<br>photo_1.jpg</td>
                        <td class="after">photo_1.jpg<br>photo_5.jpg<br>photo_50.jpg<br>photo_100.jpg</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="test-section">
            <h3>4. 模擬照片排序測試</h3>
            <button id="testSortingBtn">測試照片排序</button>
            <div id="sortingResult" class="status info" style="display: none;"></div>
            <div id="photoGrid" class="photo-grid">
                <div style="grid-column: 1 / -1; text-align: center; color: #666; padding: 20px;">
                    點擊 "測試照片排序" 按鈕查看排序效果
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>5. 已更新的功能</h3>
            <ul>
                <li>✅ <strong>Upload Photos Folder (File System Access API):</strong> 使用新的排序函數</li>
                <li>✅ <strong>Upload Photos Folder (webkitdirectory):</strong> 使用新的排序函數</li>
                <li>✅ <strong>Upload Photos Folder (Safari/Firefox):</strong> 使用新的排序函數</li>
                <li>✅ <strong>Add Photos:</strong> 新照片會按照序列號插入到正確位置</li>
                <li>✅ <strong>自動載入照片:</strong> 使用新的排序函數</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>6. 測試建議</h3>
            <p>請測試以下功能以確保排序正確：</p>
            <ol>
                <li><strong>上傳照片文件夾：</strong> 選擇包含不同序列號照片的文件夾</li>
                <li><strong>添加照片：</strong> 添加額外的照片，檢查是否插入到正確位置</li>
                <li><strong>混合文件名：</strong> 測試包含序列號和沒有序列號的照片混合情況</li>
                <li><strong>重新載入頁面：</strong> 檢查照片是否保持正確的排序順序</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>7. 操作日誌</h3>
            <div id="log" class="log"></div>
            <button id="clearLogBtn">清除日誌</button>
        </div>
    </div>

    <script>
        // 日誌函數
        function log(message, ...args) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> ${message}`;
            if (args.length > 0) {
                logEntry.innerHTML += ` ${JSON.stringify(args)}`;
            }
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // 顯示狀態
        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        // 排序函數（與 main.js 中的相同）
        function sortPhotosBySequenceNumber(photos) {
            return photos.sort((a, b) => {
                // Extract sequence numbers from filenames
                const getSequenceNumber = (filename) => {
                    const match = filename.match(/(\d+)/);
                    return match ? parseInt(match[1], 10) : 0;
                };
                
                const seqA = getSequenceNumber(a.name);
                const seqB = getSequenceNumber(b.name);
                
                // If both have sequence numbers, sort by number
                if (seqA > 0 && seqB > 0) {
                    return seqA - seqB;
                }
                
                // If only one has sequence number, prioritize it
                if (seqA > 0 && seqB === 0) return -1;
                if (seqA === 0 && seqB > 0) return 1;
                
                // If neither has sequence number, sort alphabetically
                return a.name.localeCompare(b.name, undefined, {numeric: true, sensitivity: 'base'});
            });
        }

        // 測試照片排序
        document.getElementById('testSortingBtn').addEventListener('click', () => {
            log('開始測試照片排序...');
            
            // 創建測試照片數據
            const testPhotos = [
                { name: 'IMG_10.jpg', dataURL: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2ZmMDAwMCIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPjEwPC90ZXh0Pjwvc3ZnPg==' },
                { name: 'IMG_2.jpg', dataURL: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzAwN2JmZiIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPjI8L3RleHQ+PC9zdmc+' },
                { name: 'IMG_1.jpg', dataURL: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzI4YTc0NSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPjE8L3RleHQ+PC9zdmc+' },
                { name: 'IMG_20.jpg', dataURL: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2ZmYzEwNyIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSIjMjEyNTI5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+MjA8L3RleHQ+PC9zdmc+' },
                { name: 'photo_100.jpg', dataURL: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzZkNzQ4ZCIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPjEwMDwvdGV4dD48L3N2Zz4=' },
                { name: 'photo_5.jpg', dataURL: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2RjMzU0NSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPjU8L3RleHQ+PC9zdmc+' },
                { name: 'no_number.jpg', dataURL: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzZjNzU3ZCIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5PPC90ZXh0Pjwvc3ZnPg==' }
            ];
            
            log('原始順序:', testPhotos.map(p => p.name));
            
            // 應用排序
            const sortedPhotos = sortPhotosBySequenceNumber([...testPhotos]);
            log('排序後順序:', sortedPhotos.map(p => p.name));
            
            // 顯示照片
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = '';
            
            sortedPhotos.forEach((photo, index) => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                
                // 提取序列號
                const sequenceMatch = photo.name.match(/(\d+)/);
                const sequenceNumber = sequenceMatch ? sequenceMatch[1] : 'N/A';
                
                photoItem.innerHTML = `
                    <img src="${photo.dataURL}" alt="${photo.name}">
                    <div class="sequence-number">${sequenceNumber}</div>
                    <div class="photo-name">${photo.name}</div>
                `;
                grid.appendChild(photoItem);
            });
            
            showStatus('sortingResult', '✅ 照片排序測試完成', 'success');
            log('✅ 照片排序測試完成');
        });

        // 清除日誌
        document.getElementById('clearLogBtn').addEventListener('click', () => {
            document.getElementById('log').innerHTML = '';
        });

        // 頁面載入完成
        document.addEventListener('DOMContentLoaded', () => {
            log('頁面載入完成，照片序列號排序測試準備就緒');
            log('✅ 照片現在會按照序列號從左到右順序顯示');
            log('✅ 序列號是從文件名中提取的數字');
            log('✅ 所有照片上傳功能都已更新使用新的排序邏輯');
            log('請點擊 "測試照片排序" 按鈕查看排序效果');
        });
    </script>
</body>
</html>
